{% comment %}
=========================================================
SECTION: Product Grid – Quick Shop
AUTHOR: Custom Implementation (Interview Test)
PURPOSE:
- Display 6 selectable products in a grid
- Each product has a Quick Shop (+) trigger
- Clicking trigger opens modal popup
- Popup shows product image, title, price, description, variants
- Add to cart via Shopify AJAX API (routes.cart_add_url)
- Fully responsive
- Vanilla JS only
=========================================================
{% endcomment %}

<section id="quickshop-{{ section.id }}" class="quickshop-section">

  <!-- ================= PRODUCT GRID ================= -->
  <div class="quickshop-grid">

    {% for block in section.blocks %}
      {% assign product = block.settings.product %}
      {% if product != blank %}

        <div class="quickshop-card">

          <!-- Product Image -->
          <img
            src="{{ product.featured_image | image_url: width: 600 }}"
            width="600"
            height="750"
            alt="{{ product.title | escape }}"
            loading="lazy"
          >

          <!-- Quick Shop Trigger -->
          <button
            class="quickshop-trigger"
            aria-label="Quick shop {{ product.title }}"
            data-product='{{ product | json | escape }}'>
            +
          </button>

        </div>

      {% endif %}
    {% endfor %}

  </div>

  <!-- ================= QUICK SHOP MODAL ================= -->
  <div class="quickshop-modal" aria-hidden="true">

    <!-- Overlay -->
    <div class="quickshop-overlay"></div>

    <!-- Modal Content -->
    <div class="quickshop-popup">

      <!-- Close Button -->
      <button class="quickshop-close" aria-label="Close popup">×</button>

      <!-- Product Image -->
      <img
        class="popup-image"
        src=""
        width="500"
        height="650"
        alt=""
      >

      <!-- Product Info -->
      <div class="popup-info">

        <h2 class="popup-title"></h2>
        <p class="popup-price"></p>
        <p class="popup-description"></p>

        <!-- Variant Select -->
        <select class="popup-variants"></select>

        <!-- Add To Cart -->
        <button class="popup-add-to-cart">
          ADD TO CART
        </button>

      </div>

    </div>
  </div>

</section>

<!-- ================= STYLES ================= -->
<style>
/* ---------- GRID ---------- */
.quickshop-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 24px;
}

.quickshop-card {
  position: relative;
}

.quickshop-card img {
  width: 100%;
  height: auto;
  display: block;
}

/* ---------- QUICK SHOP BUTTON ---------- */
.quickshop-trigger {
  position: absolute;
  bottom: 16px;
  right: 16px;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: none;
  background: #000;
  color: #fff;
  font-size: 22px;
  cursor: pointer;
}

/* ---------- MODAL ---------- */
.quickshop-modal {
  position: fixed;
  inset: 0;
  display: none;
  z-index: 9999;
}

.quickshop-modal.active {
  display: block;
}

.quickshop-overlay {
  position: absolute;
  inset: 0;
  background: rgba(0,0,0,0.6);
}

/* ---------- POPUP ---------- */
.quickshop-popup {
  position: relative;
  max-width: 900px;
  margin: 5vh auto;
  background: #fff;
  padding: 32px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 32px;
  z-index: 2;
}

.quickshop-close {
  position: absolute;
  top: 12px;
  right: 12px;
  font-size: 28px;
  background: none;
  border: none;
  cursor: pointer;
}

/* ---------- INFO ---------- */
.popup-title {
  font-size: 28px;
  margin-bottom: 12px;
}

.popup-price {
  font-size: 18px;
  margin-bottom: 12px;
}

.popup-description {
  margin-bottom: 16px;
}

.popup-variants {
  width: 100%;
  padding: 12px;
  margin-bottom: 16px;
}

.popup-add-to-cart {
  width: 100%;
  padding: 14px;
  background: #000;
  color: #fff;
  border: none;
  cursor: pointer;
}

/* ---------- MOBILE ---------- */
@media (max-width: 768px) {
  .quickshop-grid {
    grid-template-columns: repeat(2, 1fr);
  }

  .quickshop-popup {
    grid-template-columns: 1fr;
    max-width: 90%;
  }
}
</style>

<!-- ================= VANILLA JS ================= -->
<script>
document.addEventListener('DOMContentLoaded', function () {

  const section = document.getElementById('quickshop-{{ section.id }}');
  const modal = section.querySelector('.quickshop-modal');
  const overlay = section.querySelector('.quickshop-overlay');
  const closeBtn = section.querySelector('.quickshop-close');

  const img = section.querySelector('.popup-image');
  const title = section.querySelector('.popup-title');
  const price = section.querySelector('.popup-price');
  const desc = section.querySelector('.popup-description');
  const variantsSelect = section.querySelector('.popup-variants');
  const addToCartBtn = section.querySelector('.popup-add-to-cart');

  let currentProduct = null;

  /* ---------- OPEN MODAL ---------- */
  section.querySelectorAll('.quickshop-trigger').forEach(btn => {
    btn.addEventListener('click', () => {
      currentProduct = JSON.parse(btn.dataset.product);

      img.src = currentProduct.featured_image;
      img.alt = currentProduct.title;

      title.textContent = currentProduct.title;
      desc.innerHTML = currentProduct.body_html;
      price.textContent = (currentProduct.variants[0].price / 100).toFixed(2);

      variantsSelect.innerHTML = '';
      currentProduct.variants.forEach(variant => {
        const opt = document.createElement('option');
        opt.value = variant.id;
        opt.textContent = variant.title;
        variantsSelect.appendChild(opt);
      });

      modal.classList.add('active');
      modal.setAttribute('aria-hidden', 'false');
    });
  });

  /* ---------- CLOSE MODAL ---------- */
  [overlay, closeBtn].forEach(el => {
    el.addEventListener('click', () => {
      modal.classList.remove('active');
      modal.setAttribute('aria-hidden', 'true');
    });
  });

  /* ---------- ADD TO CART ---------- */
  addToCartBtn.addEventListener('click', () => {
    const variantId = variantsSelect.value;

    fetch('{{ routes.cart_add_url }}', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        id: variantId,
        quantity: 1
      })
    })
    .then(() => {
      modal.classList.remove('active');
    });
  });

});
</script>

{% schema %}
{
  "name": "Product Grid – Quick Shop",
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Select Product"
        }
      ]
    }
  ],
  "max_blocks": 6,
  "presets": [
    {
      "name": "Product Grid – Quick Shop"
    }
  ]
}
{% endschema %}
